<!-- âœï¸ Edit Interface Modal -->
<div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 rounded-xl shadow-lg p-6 w-96">
    <h2 class="text-xl font-semibold mb-4 text-white">Edit Interface</h2>

    <form id="editForm">
      <input type="hidden" id="editIface" name="iface" />
      <input type="hidden" id="editNatRuleNumber" name="nat_rule_number" />

      <label class="block mb-2 text-gray-300 text-sm">Description</label>
      <input
        type="text"
        id="editDescription"
        name="description"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      />

      <label class="block mb-2 text-gray-300 text-sm">Zone</label>
      <select
        id="editZone"
        name="zone"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="">Select zone...</option>
        {% for zone in zones %}
        <option value="{{ zone }}">{{ zone }}</option>
        {% endfor %}
      </select>

      <label class="block mb-2 text-gray-300 text-sm">Address Mode</label>
      <select
        id="editMode"
        name="mode"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="dhcp">DHCP</option>
        <option value="static">Static</option>
      </select>

      <label class="block mb-2 text-gray-300 text-sm">Address</label>
      <input
        type="text"
        id="editAddress"
        name="address"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
        pattern="^(?:\d{1,3}\.){3}\d{1,3}\/\d{1,2}$"
        placeholder="e.g. 192.168.9.1/24"
      />

      <label class="block mb-2 text-gray-300 text-sm">Source NAT Outbound Interface</label>
      <select
        id="editNatInterface"
        name="source_nat_interface"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="">No Source NAT</option>
        {% for nat_iface in source_nat_interfaces %}
        <option value="{{ nat_iface }}">{{ nat_iface }}</option>
        {% endfor %}
      </select>

      <div class="flex justify-end gap-3">
        <button type="button" id="cancelEdit" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded">
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded flex items-center justify-center gap-2"
        >
          <span class="material-icons animate-spin text-sm hidden" id="editSpinner">refresh</span>
          <span id="editSubmitLabel">Save</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- âž• Add Interface Modal -->
<div id="addInterfaceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 rounded-xl shadow-lg p-6 w-[28rem] text-white">
    <h2 class="text-xl font-semibold mb-4">Add Interface</h2>

    <form id="addInterfaceForm">
      <label class="block mb-2 text-gray-300 text-sm">Interface</label>
      <select
        id="addInterfaceSelect"
        name="interface"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
        {% if not available_interfaces %}disabled{% endif %}
      >
        <option value="">Select interface...</option>
        {% for iface in available_interfaces %}
        <option value="{{ iface }}">{{ iface }}</option>
        {% endfor %}
      </select>
      {% if not available_interfaces %}
      <p class="text-sm text-gray-400 mb-4">All ethernet interfaces are currently in use.</p>
      {% endif %}

      <label class="block mb-2 text-gray-300 text-sm">Description</label>
      <input
        type="text"
        id="addInterfaceDescription"
        name="description"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      />

      <label class="block mb-2 text-gray-300 text-sm">Zone (optional)</label>
      <select
        id="addInterfaceZone"
        name="zone"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
        data-require-selection="false"
        {% if not zones %}disabled{% endif %}
      >
        <option value="">No zone assignment</option>
        {% for zone in zones %}
        <option value="{{ zone }}">{{ zone }}</option>
        {% endfor %}
      </select>
      {% if not zones %}
      <p class="text-sm text-yellow-300 mb-4">No firewall zones available. Please configure zones first.</p>
      {% endif %}

      <label class="block mb-2 text-gray-300 text-sm">Address Mode</label>
      <select
        id="addInterfaceMode"
        name="mode"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="dhcp">DHCP</option>
        <option value="static" selected>Static</option>
      </select>

      <label class="block mb-2 text-gray-300 text-sm">Address (CIDR)</label>
      <input
        type="text"
        id="addInterfaceAddress"
        name="address"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
        placeholder="e.g. 192.168.9.1/24"
        pattern="^(?:\d{1,3}\.){3}\d{1,3}\/\d{1,2}$"
        title="Enter an IPv4 address in CIDR format, e.g. 192.168.9.1/24"
      />

      <label class="block mb-2 text-gray-300 text-sm">Source NAT Outbound Interface</label>
      <select
        id="addInterfaceNat"
        name="source_nat_interface"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="">No Source NAT</option>
        {% for nat_iface in source_nat_interfaces %}
        <option value="{{ nat_iface }}">{{ nat_iface }}</option>
        {% endfor %}
      </select>

      <div class="flex justify-end gap-3 mt-4">
        <button type="button" id="cancelAddInterface" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded">
          Cancel
        </button>
        <button
          type="submit"
          id="submitAddInterface"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded flex items-center justify-center gap-2"
          {% if not available_interfaces %}disabled{% endif %}
        >
          <span class="material-icons animate-spin text-sm hidden" id="addInterfaceSpinner">refresh</span>
          <span id="addInterfaceSubmitLabel">Create</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- âž• Create VLAN Modal -->
<div id="createModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 rounded-xl shadow-lg p-6 w-[28rem] text-white">
    <h2 class="text-xl font-semibold mb-4">Create VLAN</h2>

    <form id="createForm">
      <label class="block mb-2 text-gray-300 text-sm">Parent Interface</label>
      <select
        id="vlanParent"
        name="parent"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="">Select parent interface...</option>
        {% for name, info in interfaces.items() %}
          {% if '.' not in name and '@' not in name %}
          <option value="{{ name }}">{{ name }}</option>
          {% endif %}
        {% endfor %}
      </select>

      <label class="block mb-2 text-gray-300 text-sm">VLAN ID</label>
      <input
        type="number"
        id="vlanId"
        name="vlan_id"
        min="1"
        max="4094"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
        placeholder="e.g. 5"
      />

      <label class="block mb-2 text-gray-300 text-sm">Description</label>
      <input
        type="text"
        id="vlanDescription"
        name="description"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      />

      <label class="block mb-2 text-gray-300 text-sm">Zone</label>
      <select
        id="vlanZone"
        name="zone"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
        {% if not zones %}disabled{% endif %}
      >
        <option value="">Select zone...</option>
        {% for zone in zones %}
        <option value="{{ zone }}">{{ zone }}</option>
        {% endfor %}
      </select>
      {% if not zones %}
      <p class="text-sm text-yellow-300 mb-4">No firewall zones available. Please configure zones first.</p>
      {% endif %}

      <label class="block mb-2 text-gray-300 text-sm">Address Mode</label>
      <select
        id="vlanMode"
        name="mode"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="dhcp">DHCP</option>
        <option value="static" selected>Static</option>
      </select>

      <label class="block mb-2 text-gray-300 text-sm">Address</label>
      <input
        type="text"
        id="vlanAddress"
        name="address"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
        placeholder="e.g. 10.69.69.1/24"
      />

      <label class="block mb-2 text-gray-300 text-sm">Source NAT Outbound Interface</label>
      <select
        id="vlanNatInterface"
        name="source_nat_interface"
        class="w-full p-2 mb-4 rounded bg-gray-700 text-white border border-gray-600"
      >
        <option value="">No Source NAT</option>
        {% for nat_iface in source_nat_interfaces %}
        <option value="{{ nat_iface }}">{{ nat_iface }}</option>
        {% endfor %}
      </select>

      <div class="flex justify-end gap-3 mt-4">
        <button type="button" id="cancelCreate" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded">
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded flex items-center justify-center gap-2"
          id="createVlanSubmit"
        >
          <span class="material-icons animate-spin text-sm hidden" id="createVlanSpinner">refresh</span>
          <span id="createVlanSubmitLabel">Create</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ðŸ—‘ï¸ Delete Interface Modal -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 rounded-xl shadow-lg p-6 w-[26rem] text-white border border-gray-700">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold">Delete Interface</h3>
      <button class="material-icons text-gray-400 hover:text-white" data-delete-close="true">close</button>
    </div>
    <p class="text-gray-300 mb-4" id="deleteMessage">
      Are you sure you want to delete <span id="deleteIfaceName" class="font-bold text-red-400">--</span>?
    </p>
    <div class="bg-gray-900 border border-gray-700 rounded-lg p-4 text-sm text-gray-200 mb-4 space-y-2">
      <div class="flex justify-between">
        <span class="text-gray-400">Interface</span>
        <span class="font-semibold" id="deleteInterfaceValue">--</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-400">Zone</span>
        <span class="font-semibold" id="deleteZoneValue">--</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-400">Address</span>
        <span class="font-semibold" id="deleteAddressValue">--</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-400">Description</span>
        <span class="font-semibold" id="deleteDescriptionValue">--</span>
      </div>
    </div>
    <p class="text-xs text-gray-400 mb-6">
      This action cannot be undone. Deleting an interface will remove its configuration from the device.
    </p>
    <div class="flex justify-end gap-3">
      <button id="cancelDelete" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded" data-delete-close="true">
        Cancel
      </button>
      <button
        id="confirmDelete"
        class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded flex items-center justify-center gap-2"
      >
        <span class="material-icons animate-spin text-sm hidden" id="deleteSpinner">refresh</span>
        <span id="deleteSubmitLabel">Delete</span>
      </button>
    </div>
  </div>
</div>

<!-- ðŸ”Œ Toggle Interface State Modal -->
<div id="togglePowerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 rounded-xl shadow-lg p-6 w-[26rem] text-white border border-gray-700">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold" id="togglePowerTitle">Disable Interface</h3>
      <button class="material-icons text-gray-400 hover:text-white" data-toggle-power-close="true">close</button>
    </div>
    <p class="text-gray-300 mb-4" id="togglePowerMessage">Disable interface?</p>
    <div class="bg-gray-900 border border-gray-700 rounded-lg p-4 text-sm text-gray-200 mb-4 space-y-2">
      <div class="flex justify-between">
        <span class="text-gray-400">Interface</span>
        <span class="font-semibold" id="togglePowerInterface">--</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-400">Current State</span>
        <span class="font-semibold" id="togglePowerState">--</span>
      </div>
    </div>
    <p class="text-xs text-gray-400 mb-6">
      The interface will change state immediately. Services depending on this interface may be impacted.
    </p>
    <div class="flex justify-end gap-3">
      <button class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded" data-toggle-power-close="true">
        Cancel
      </button>
      <button
        id="confirmTogglePower"
        class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white font-semibold inline-flex items-center gap-2"
      >
        <span class="material-icons animate-spin text-sm hidden" id="togglePowerSpinner">refresh</span>
        <span id="togglePowerSubmitLabel">Disable</span>
      </button>
    </div>
  </div>
</div>

<!-- ðŸ”— Remove Zone Assignment Modal -->
<div id="unassignZoneModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 rounded-xl shadow-lg p-6 w-[26rem] text-white border border-gray-700">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold">Remove from Zone</h3>
      <button class="material-icons text-gray-400 hover:text-white" data-unassign-close="true">close</button>
    </div>
    <p class="text-gray-300 mb-4" id="unassignZoneMessage">Remove interface from the selected zone?</p>
    <div class="bg-gray-900 border border-gray-700 rounded-lg p-4 text-sm text-gray-200 mb-4 space-y-2">
      <div class="flex justify-between">
        <span class="text-gray-400">Interface</span>
        <span class="font-semibold" id="unassignZoneInterface">--</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-400">Current Zone</span>
        <span class="font-semibold" id="unassignZoneZone">--</span>
      </div>
    </div>
    <p class="text-xs text-gray-400 mb-6">
      The interface will remain configured, but its firewall zone membership will be cleared.
    </p>
    <div class="flex justify-end gap-3">
      <button class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded" data-unassign-close="true">
        Cancel
      </button>
      <button
        id="confirmUnassignZone"
        class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 rounded text-gray-900 font-semibold inline-flex items-center gap-2"
      >
        <span class="material-icons animate-spin text-sm hidden" id="unassignZoneSpinner">refresh</span>
        <span id="unassignZoneSubmitLabel">Remove</span>
      </button>
    </div>
  </div>
</div>
