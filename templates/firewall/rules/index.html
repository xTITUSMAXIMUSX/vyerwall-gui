{% extends 'base.html' %}
{% block title %}Firewall Rules{% endblock %}
{% set active = 'firewall' %}
{% set active_subnav = 'rules' %}
{% block header %}
<div class="flex items-center gap-3 mb-2">
  <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg">
    <span class="material-icons text-white text-2xl">rule</span>
  </div>
  <div>
    <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">
      Firewall Rules
    </h1>
    <p class="text-gray-400 text-sm">Manage zone-based firewall rule sets and policies</p>
  </div>
</div>
{% endblock %}

{% set initial_meta = initial_details.metadata if initial_details else {} %}
{% set initial_rules = initial_details.rules if initial_details else [] %}
{% set protocol_options = [
  'all', 'tcp_udp', 'ah', 'ax.25', 'dccp', 'ddp', 'egp', 'eigrp', 'encap',
  'esp', 'etherip', 'ethernet', 'fc', 'ggp', 'gre', 'hip', 'hmp', 'hopopt',
  'icmp', 'idpr-cmtp', 'idrp', 'igmp', 'igp', 'ip', 'ipcomp', 'ipencap', 'ipip',
  'ipv6', 'ipv6-frag', 'ipv6-icmp', 'ipv6-nonxt', 'ipv6-opts', 'ipv6-route',
  'isis', 'iso-tp4', 'l2tp', 'manet', 'mobility-header', 'mpls-in-ip', 'mptcp',
  'ospf', 'pim', 'pup', 'rdp', 'rohc', 'rspf', 'rsvp', 'sctp', 'shim6', 'skip',
  'st', 'tcp', 'udp', 'udplite', 'vmtp', 'vrrp', 'wesp', 'xns-idp', 'xtp'
] %}
{% set protocol_labels = {'all': 'All'} %}
{% set action_meta = {
  'accept': {'icon': 'check_circle', 'class': 'text-green-400', 'label': 'Accept rule'},
  'drop': {'icon': 'cancel', 'class': 'text-red-500', 'label': 'Drop rule'},
  'reject': {'icon': 'do_not_disturb_on', 'class': 'text-amber-400', 'label': 'Reject rule'},
  'default': {'icon': 'radio_button_unchecked', 'class': 'text-gray-500', 'label': 'No action set'}
} %}
{% set named_ports = [
  {'label': 'ftp (21/tcp)', 'value': '21', 'protocol': 'tcp'},
  {'label': 'ssh (22/tcp)', 'value': '22', 'protocol': 'tcp'},
  {'label': 'telnet (23/tcp)', 'value': '23', 'protocol': 'tcp'},
  {'label': 'smtp (25/tcp)', 'value': '25', 'protocol': 'tcp'},
  {'label': 'dns (53/tcp)', 'value': '53', 'protocol': 'tcp'},
  {'label': 'dns (53/udp)', 'value': '53', 'protocol': 'udp'},
  {'label': 'http (80/tcp)', 'value': '80', 'protocol': 'tcp'},
  {'label': 'https (443/tcp)', 'value': '443', 'protocol': 'tcp'},
  {'label': 'ntp (123/udp)', 'value': '123', 'protocol': 'udp'},
  {'label': 'pop3 (110/tcp)', 'value': '110', 'protocol': 'tcp'},
  {'label': 'imap (143/tcp)', 'value': '143', 'protocol': 'tcp'},
  {'label': 'ldap (389/tcp)', 'value': '389', 'protocol': 'tcp'},
  {'label': 'ldaps (636/tcp)', 'value': '636', 'protocol': 'tcp'},
  {'label': 'sqlnet (1521/tcp)', 'value': '1521', 'protocol': 'tcp'},
  {'label': 'ms-sql-s (1433/tcp)', 'value': '1433', 'protocol': 'tcp'},
  {'label': 'rdp (3389/tcp)', 'value': '3389', 'protocol': 'tcp'},
  {'label': 'ike (500/udp)', 'value': '500', 'protocol': 'udp'},
  {'label': 'syslog (514/udp)', 'value': '514', 'protocol': 'udp'},
  {'label': 'snmp (161/udp)', 'value': '161', 'protocol': 'udp'},
  {'label': 'snmptrap (162/udp)', 'value': '162', 'protocol': 'udp'},
  {'label': 'rdp-udp (3389/udp)', 'value': '3389', 'protocol': 'udp'},
  {'label': 'poppassd (106/tcp)', 'value': '106', 'protocol': 'tcp'},
  {'label': 'moira-db (775/tcp)', 'value': '775', 'protocol': 'tcp'},
  {'label': 'moira-update (777/tcp)', 'value': '777', 'protocol': 'tcp'},
  {'label': 'moira-ureg (779/udp)', 'value': '779', 'protocol': 'udp'},
  {'label': 'spamd (783/tcp)', 'value': '783', 'protocol': 'tcp'},
  {'label': 'skkserv (1178/tcp)', 'value': '1178', 'protocol': 'tcp'},
  {'label': 'predict (1210/udp)', 'value': '1210', 'protocol': 'udp'},
  {'label': 'rmtcfg (1236/tcp)', 'value': '1236', 'protocol': 'tcp'},
  {'label': 'xtel (1313/tcp)', 'value': '1313', 'protocol': 'tcp'},
  {'label': 'xtelw (1314/tcp)', 'value': '1314', 'protocol': 'tcp'},
  {'label': 'zebrasrv (2600/tcp)', 'value': '2600', 'protocol': 'tcp'},
  {'label': 'zebra (2601/tcp)', 'value': '2601', 'protocol': 'tcp'},
  {'label': 'ripd (2602/tcp)', 'value': '2602', 'protocol': 'tcp'},
  {'label': 'ripngd (2603/tcp)', 'value': '2603', 'protocol': 'tcp'},
  {'label': 'ospfd (2604/tcp)', 'value': '2604', 'protocol': 'tcp'},
  {'label': 'bgpd (2605/tcp)', 'value': '2605', 'protocol': 'tcp'},
  {'label': 'ospf6d (2606/tcp)', 'value': '2606', 'protocol': 'tcp'},
  {'label': 'ospfapi (2607/tcp)', 'value': '2607', 'protocol': 'tcp'},
  {'label': 'isisd (2608/tcp)', 'value': '2608', 'protocol': 'tcp'},
  {'label': 'fax (4557/tcp)', 'value': '4557', 'protocol': 'tcp'},
  {'label': 'hylafax (4559/tcp)', 'value': '4559', 'protocol': 'tcp'},
  {'label': 'munin (4949/tcp)', 'value': '4949', 'protocol': 'tcp'},
  {'label': 'rplay (5555/udp)', 'value': '5555', 'protocol': 'udp'},
  {'label': 'nrpe (5666/tcp)', 'value': '5666', 'protocol': 'tcp'},
  {'label': 'nsca (5667/tcp)', 'value': '5667', 'protocol': 'tcp'},
  {'label': 'canna (5680/tcp)', 'value': '5680', 'protocol': 'tcp'},
  {'label': 'syslog-tls (6514/tcp)', 'value': '6514', 'protocol': 'tcp'},
  {'label': 'sane-port (6566/tcp)', 'value': '6566', 'protocol': 'tcp'},
  {'label': 'ircd (6667/tcp)', 'value': '6667', 'protocol': 'tcp'},
  {'label': 'zope-ftp (8021/tcp)', 'value': '8021', 'protocol': 'tcp'},
  {'label': 'tproxy (8081/tcp)', 'value': '8081', 'protocol': 'tcp'},
  {'label': 'omniorb (8088/tcp)', 'value': '8088', 'protocol': 'tcp'},
  {'label': 'clc-build-daemon (8990/tcp)', 'value': '8990', 'protocol': 'tcp'},
  {'label': 'xinetd (9098/tcp)', 'value': '9098', 'protocol': 'tcp'},
  {'label': 'git (9418/tcp)', 'value': '9418', 'protocol': 'tcp'},
  {'label': 'zope (9673/tcp)', 'value': '9673', 'protocol': 'tcp'},
  {'label': 'webmin (10000/tcp)', 'value': '10000', 'protocol': 'tcp'},
  {'label': 'kamanda (10081/tcp)', 'value': '10081', 'protocol': 'tcp'},
  {'label': 'amandaidx (10082/tcp)', 'value': '10082', 'protocol': 'tcp'},
  {'label': 'amidxtape (10083/tcp)', 'value': '10083', 'protocol': 'tcp'},
  {'label': 'sgi-cmsd (17001/udp)', 'value': '17001', 'protocol': 'udp'},
  {'label': 'sgi-crsd (17002/udp)', 'value': '17002', 'protocol': 'udp'},
  {'label': 'sgi-gcd (17003/udp)', 'value': '17003', 'protocol': 'udp'},
  {'label': 'sgi-cad (17004/tcp)', 'value': '17004', 'protocol': 'tcp'},
  {'label': 'binkp (24554/tcp)', 'value': '24554', 'protocol': 'tcp'},
  {'label': 'asp (27374/tcp)', 'value': '27374', 'protocol': 'tcp'},
  {'label': 'asp (27374/udp)', 'value': '27374', 'protocol': 'udp'},
  {'label': 'csync2 (30865/tcp)', 'value': '30865', 'protocol': 'tcp'},
  {'label': 'dircproxy (57000/tcp)', 'value': '57000', 'protocol': 'tcp'},
  {'label': 'tfido (60177/tcp)', 'value': '60177', 'protocol': 'tcp'},
  {'label': 'fido (60179/tcp)', 'value': '60179', 'protocol': 'tcp'}
] %}

{% block content %}
{# Local styles specific to this view #}
<style>
  #firewallRulesBody tr.firewall-drop-target {
    position: relative;
    border-top: 2px solid #60a5fa;
    background-color: rgba(59, 130, 246, 0.15);
    transition: background-color 0.15s ease, border-color 0.15s ease;
  }

  #firewallRulesBody tr:hover {
    background-color: rgba(139, 92, 246, 0.05);
  }
</style>


<div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl shadow-2xl flex overflow-hidden min-h-[32rem] border border-gray-700/50">
  {% include 'firewall/rules/_zone_list.html' %}
  {% include 'firewall/rules/_zone_pairs.html' %}

  <section class="flex-1 p-6 space-y-6 overflow-y-auto">
    {% include 'firewall/rules/_summary.html' %}
    {% include 'firewall/rules/_legend.html' %}
    {% include 'firewall/rules/_rules_table.html' %}
  </section>
</div>

<script>
  window.FIREWALL_RULES_VIEW_DATA = {
    names: {{ firewall_names | tojson }},
    metadata: {{ firewall_metadata | tojson }},
    zoneGroups: {{ firewall_zone_groups | tojson }},
    initialZone: {{ initial_zone | tojson }},
    initialName: {{ initial_name | tojson }},
    initialDetails: {{ initial_details | tojson }},
  };
</script>

{% include 'firewall/rules/_modals.html' %}

<div id="toastContainer" class="fixed bottom-6 right-6 z-50 flex flex-col gap-3"></div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/firewall/constants.js') }}"></script>
<script src="{{ url_for('static', filename='js/firewall/utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/firewall/state.js') }}"></script>
<script src="{{ url_for('static', filename='js/firewall/controller/forms.js') }}"></script>
<script src="{{ url_for('static', filename='js/firewall/controller/view.js') }}"></script>
<script src="{{ url_for('static', filename='js/firewall/controller/api.js') }}"></script>
<script src="{{ url_for('static', filename='js/firewall/controller.js') }}"></script>
<script src="{{ url_for('static', filename='js/firewall/index.js') }}"></script>
{% endblock %}
