<!-- Add Rule Modal -->
<div id="addRuleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-900 rounded-xl shadow-lg w-[32rem] p-6 border border-gray-700">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold text-white">Add Firewall Rule</h3>
      <button class="material-icons text-gray-400 hover:text-white" data-close-modal="addRuleModal">close</button>
    </div>
    <form id="addRuleForm" class="space-y-4">
      <input type="hidden" name="number">
      <div>
        <label class="block text-sm text-gray-300 mb-1">Action</label>
        <select name="action" required
          class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
          <option value="accept">Accept</option>
          <option value="drop">Drop</option>
          <option value="reject">Reject</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">Protocol</label>
          <select name="protocol"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
            {% for proto in protocol_options %}
            <option value="{{ proto }}" {% if proto == 'tcp_udp' %}selected{% endif %}>{{ protocol_labels.get(proto, proto) }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Description</label>
          <input type="text" name="description" placeholder="Rule description"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">Source Address</label>
          <input type="text" name="sourceAddress" placeholder="0.0.0.0/0"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Source Port</label>
          <div class="space-y-2">
            <select data-port-select="source"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
              <option value="other" data-protocol="" selected>Other</option>
              {% for port in named_ports %}
              <option value="{{ port.value }}" data-protocol="{{ port.protocol }}">{{ port.label }}</option>
              {% endfor %}
            </select>
            <input type="text" name="sourcePort" data-port-input="source" placeholder="telnet,http,123,1001-1005"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
          </div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">Destination Address</label>
          <input type="text" name="destinationAddress" placeholder="0.0.0.0/0"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Destination Port</label>
          <div class="space-y-2">
            <select data-port-select="destination"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
              <option value="other" data-protocol="" selected>Other</option>
              {% for port in named_ports %}
              <option value="{{ port.value }}" data-protocol="{{ port.protocol }}">{{ port.label }}</option>
              {% endfor %}
            </select>
            <input type="text" name="destinationPort" data-port-input="destination" placeholder="telnet,http,123,1001-1005"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-2">
        <button type="button" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded"
          data-close-modal="addRuleModal">Cancel</button>
        <button type="submit" id="addRuleSubmit"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white inline-flex items-center gap-2">
          <span class="material-icons text-sm animate-spin hidden" id="addRuleSpinner">refresh</span>
          <span id="addRuleSubmitLabel">Create Rule</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Rule Modal -->
<div id="editRuleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-900 rounded-xl shadow-lg w-[32rem] p-6 border border-gray-700">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold text-white">Edit Firewall Rule</h3>
      <button class="material-icons text-gray-400 hover:text-white" data-close-modal="editRuleModal">close</button>
    </div>
    <form id="editRuleForm" class="space-y-4">
      <input type="hidden" name="originalNumber">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">Rule Number</label>
          <input type="number" name="number" min="1" required readonly
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none opacity-70 cursor-not-allowed">
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Action</label>
          <select name="action" required
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
            <option value="accept">Accept</option>
            <option value="drop">Drop</option>
            <option value="reject">Reject</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">Protocol</label>
          <select name="protocol"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus-border-blue-500 focus:outline-none">
            <option value="">Select protocol</option>
            {% for proto in protocol_options %}
            <option value="{{ proto }}">{{ protocol_labels.get(proto, proto) }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Description</label>
          <input type="text" name="description"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">Source Address</label>
          <input type="text" name="sourceAddress"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Source Port</label>
          <div class="space-y-2">
            <select data-port-select="source"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
              <option value="other" data-protocol="" selected>Other</option>
              {% for port in named_ports %}
              <option value="{{ port.value }}" data-protocol="{{ port.protocol }}">{{ port.label }}</option>
              {% endfor %}
            </select>
            <input type="text" name="sourcePort" data-port-input="source"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
          </div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-300 mb-1">Destination Address</label>
          <input type="text" name="destinationAddress"
            class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>
        <div>
          <label class="block text-sm text-gray-300 mb-1">Destination Port</label>
          <div class="space-y-2">
            <select data-port-select="destination"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
              <option value="other" data-protocol="" selected>Other</option>
              {% for port in named_ports %}
              <option value="{{ port.value }}" data-protocol="{{ port.protocol }}">{{ port.label }}</option>
              {% endfor %}
            </select>
            <input type="text" name="destinationPort" data-port-input="destination"
              class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600 focus:border-blue-500 focus:outline-none">
          </div>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <input type="checkbox" id="editRuleDisabled" name="disabled"
          class="h-4 w-4 text-blue-500 bg-gray-800 border border-gray-600 rounded">
        <label for="editRuleDisabled" class="text-sm text-gray-300 select-none">Disable rule</label>
      </div>

      <div class="flex justify-end gap-3 pt-2">
        <button type="button" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded"
          data-close-modal="editRuleModal">Cancel</button>
        <button type="submit" id="editRuleSubmit"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white inline-flex items-center gap-2">
          <span class="material-icons text-sm animate-spin hidden" id="editRuleSpinner">refresh</span>
          <span id="editRuleSubmitLabel">Save Changes</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Rule Modal -->
<div id="deleteRuleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-900 rounded-xl shadow-lg w-[26rem] p-6 border border-gray-700">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold text-white">Delete Firewall Rule</h3>
      <button class="material-icons text-gray-400 hover:text-white" data-close-modal="deleteRuleModal">close</button>
    </div>
    <p class="text-gray-300 mb-6" id="deleteRuleMessage">
      Are you sure you want to delete rule <span class="font-semibold">--</span>?
    </p>
    <div class="flex justify-end gap-3">
      <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded"
        data-close-modal="deleteRuleModal">Cancel</button>
      <button id="confirmDeleteRule"
        class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white inline-flex items-center gap-2">
        <span class="material-icons text-sm animate-spin hidden" id="deleteRuleSpinner">refresh</span>
        <span id="deleteRuleSubmitLabel">Delete</span>
      </button>
    </div>
  </div>
</div>

<!-- Disable Rule Modal -->
<div id="disableRuleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-900 rounded-xl shadow-lg w-[26rem] p-6 border border-gray-700">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-semibold text-white">Toggle Rule State</h3>
      <button class="material-icons text-gray-400 hover:text-white" data-close-modal="disableRuleModal">close</button>
    </div>
    <p class="text-gray-300 mb-6" id="disableRuleMessage">
      Are you sure you want to disable rule <span class="font-semibold">--</span>?
    </p>
    <div class="flex justify-end gap-3">
      <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded"
        data-close-modal="disableRuleModal">Cancel</button>
      <button id="confirmDisableRule"
        class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 rounded text-gray-900 font-semibold inline-flex items-center gap-2">
        <span class="material-icons text-sm animate-spin hidden" id="disableRuleSpinner">refresh</span>
        <span id="disableRuleSubmitLabel">Confirm</span>
      </button>
    </div>
  </div>
</div>
